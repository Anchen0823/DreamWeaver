# DreamWeaver (画布产品课程项目)
A canvas app for ByteDance campus
## 1. 项目简介



本项目是“画布产品课程”的结项作业，旨在从零到一实现一个简化版的画布产品 (如 Figma, Excalidraw)。项目代号 "DreamWeaver"，将重点探索图形渲染、交互设计与状态管理的核心逻辑。

**技术栈**: Vue 3 + TypeScript + DOM

**技术选型说明**:
- ✅ 使用 DOM + CSS 进行图形渲染（完全自研，未使用任何图形库）
- ✅ 未使用 react-flow、tldraw、konva、fabric.js 等禁止的图形库
- ✅ 所有核心业务逻辑（渲染、样式计算、数据结构）均为自研实现
- ✅ 使用 Vue 3 Composition API 和 TypeScript 保证类型安全 

## 2. 如何启动项目



1.  **环境要求**:
    * Node.js (建议 v18+)
    * pnpm (或 npm / yarn)

2.  **克隆仓库**:
    ```bash
    git clone [https://github.com/Anchen0823/DreamWeaver]
    cd DreamWeaver
    ```

3.  **安装依赖**:
    ```bash
    npm install
    ```

4.  **启动本地开发环境**:
    ```bash
    npm run dev
    ```

5.  在浏览器中打开 `http://localhost:5173/` (或终端提示的地址)。

## 3. 主要目录结构说明

```
DreamWeaver/
├── app/                    # 主应用目录
│   ├── src/
│   │   ├── components/     # Vue 组件
│   │   │   ├── Canvas.vue  # 画布组件
│   │   │   ├── Toolbar.vue # 底部工具栏组件
│   │   │   ├── LayersPanel.vue # 左侧图层面板组件
│   │   │   ├── LayerThumbnail.vue # 图层缩略图组件
│   │   │   ├── TextToolbar.vue # 文本浮动工具栏组件
│   │   │   ├── ShapeToolbar.vue # 图形浮动工具栏组件
│   │   │   ├── ImageToolbar.vue # 图片浮动工具栏组件
│   │   │   └── icons/      # 图标组件
│   │   │       ├── MoveIcon.vue
│   │   │       ├── RectangleIcon.vue
│   │   │       ├── CircleIcon.vue
│   │   │       ├── TriangleIcon.vue
│   │   │       ├── ImageIcon.vue
│   │   │       └── TextIcon.vue
│   │   ├── composables/   # 组合式函数
│   │   │   ├── useViewport.ts
│   │   │   ├── useCanvasInteraction.ts
│   │   │   ├── useElementSelection.ts
│   │   │   ├── useElementDrag.ts
│   │   │   ├── useElementZoom.ts
│   │   │   ├── useResize.ts
│   │   │   ├── useTextEditing.ts
│   │   │   ├── useDrawing.ts
│   │   │   ├── usePersistence.ts
│   │   │   └── useClipboard.ts
│   │   ├── stores/         # Pinia 状态管理（待实现）
│   │   ├── types/          # TypeScript 类型定义
│   │   │   └── canvas.ts   # 画布元素类型定义
│   │   ├── utils/          # 工具函数
│   │   │   ├── style-calculator.ts
│   │   │   ├── coordinate-utils.ts
│   │   │   └── mock-data.ts
│   │   ├── App.vue         # 根组件
│   │   └── main.ts         # 入口文件
│   ├── public/             # 静态资源
│   └── package.json        # 项目配置
├── docs/                   # 文档目录
│   ├── DATA_STRUCTURE.md   # 数据结构设计文档
│   └── REFACTORING.md      # 重构文档
└── README.md               # 项目说明
```




## 4. 已实现功能列表



### 第 1 周 (2025-11-21)
* [√] 完成项目规划与技术选型 (Vue 3 + DOM)
* [√] 搭建项目框架 (Vite + TS + Pinia + ESLint)
* [√] 完成核心数据结构设计
* [√] 实现基础渲染 Demo
* [√] 图形渲染：矩形、圆角矩形、圆形、三角形
* [√] 图形属性：背景色、边框宽度、边框颜色
* [√] 三角形轮廓渲染：使用 clip-path 和伪元素，从重心点缩放保持相似性
* [√] 图片渲染：支持 PNG、JPEG 格式
* [√] 图片滤镜：灰度、模糊、对比度
* [√] 富文本渲染：字体、字号、颜色、背景色
* [√] 文本样式：加粗、斜体、下划线、删除线

### 第 2 周 (2025-11-28)
* [√] 实现画布交互
  * [√] 画布缩放（Ctrl/Cmd + 鼠标滚轮，缩放范围 0.1x - 5x）
  * [√] 画布拖拽（空格键 + 左键或中键拖拽）
  * [√] 画布滚动（无限画布，支持垂直和水平滚动）
  * [√] 网格背景（20px 网格，随缩放动态调整）
* [√] 实现选区功能
  * [√] 点击选中单个元素
  * [√] 框选选中多个元素（左键拖动框选）
  * [√] 选中状态视觉反馈（蓝色选中框）
  * [√] 多选支持（Ctrl/Cmd + 点击或框选）
* [√] 实现底部工具栏
  * [√] 工具栏UI设计（漂浮卡片样式，居中显示）
  * [√] Move工具（默认选择/移动工具）
  * [√] 图形工具（矩形、圆角矩形、圆形、三角形）
  * [√] 图片工具（支持文件选择）
  * [√] 文本工具
  * [√] 工具状态管理（选中状态高亮）
  * [√] 绘制完成后自动切换回Move工具
* [√] 实现拖拽绘制功能
  * [√] 图形拖拽绘制（实时预览）
  * [√] 图片拖拽绘制（保持宽高比）
  * [√] 文本拖拽绘制（字体大小自适应）
  * [√] 绘制预览（选中框轮廓、尺寸标签）
  * [√] 文本预览优化（绘制时不显示内容）
* [√] 实现元素编辑
  * [√] 双击文本进入编辑模式
  * [√] 元素删除功能（Delete/Backspace）
  * [√] 元素拖拽移动（支持单个或多个元素同时移动）
  * [√] 元素缩放（角点和边缘拖动）
* [√] 实现复制粘贴功能
  * [√] Ctrl/Cmd + C 复制选中元素
  * [√] Ctrl/Cmd + V 粘贴元素（支持多选）
* [√] 实现数据持久化
  * [√] IndexedDB存储方案
  * [√] 自动保存功能
  * [√] 页面刷新后数据恢复
* [√] 实现元素调整大小功能
  * [√] 角点选择点拖动调整大小
  * [√] 边缘拖动调整大小
  * [√] 尺寸标签显示（元素下方中心）
  * [√] 圆形和图片宽高比保持
* [√] 实现左侧图层面板
  * [√] 显示所有画布元素列表
  * [√] 元素缩略图预览（图形、图片、文本）
  * [√] 点击图层选择元素（支持 Ctrl/Cmd 多选）
  * [√] 选中状态同步显示
  * [√] 滚动条悬停显示优化
* [√] 实现浮动工具栏
  * [√] 文本浮动工具栏（选中文本元素时显示在上方）
  * [√] 图形浮动工具栏（选中图形元素时显示在上方）
  * [√] 图片浮动工具栏（选中图片元素时显示在上方）
  * [√] 工具栏动态定位（跟随元素位置和视口缩放自动调整）
  * [√] 工具栏属性设置（支持实时修改元素属性）

### 第 3 周 (2025-12-05)
* [√] 图形渲染优化
  * [√] 修复三角形轮廓渲染问题
  * [√] 使用 clip-path 和伪元素实现三角形轮廓
  * [√] 从三角形重心点统一缩放，保持内外三角形相似性
  * [√] 优化预览组件中的三角形轮廓渲染
* [ ] 性能优化
  * [ ] 优化100个元素的渲染性能（目标<3s）
  * [ ] 实现虚拟滚动/渲染优化
  * [ ] 操作性能优化（防抖、节流）
* [ ] 进阶功能实现
  * [ ] 元素旋转功能（⭐️挑战）
  * [ ] 撤销/重做功能（⭐️⭐️⭐️挑战）
  * [ ] 组合/解组功能（⭐️⭐️挑战）
  * [ ] 无限画布滚动条（⭐️⭐️挑战）
* [ ] 交互体验打磨
  * [ ] 优化所有交互细节
  * [ ] 添加加载状态和错误处理
  * [ ] 优化工具栏和UI细节
* [ ] 代码质量和测试
  * [ ] 代码规范检查和修复
  * [ ] 完善TypeScript类型定义
  * [ ] 代码重构和优化

---

### 进阶挑战 (Challenges)
* [ ] 元素旋转功能（⭐️）
* [ ] 组合/解组功能（⭐️⭐️）
* [ ] 撤销/重做功能（⭐️⭐️⭐️）
* [√] 无限画布滚动条（⭐️⭐️）- 已实现无限画布和滚动功能
* [ ] Minimap功能（⭐️⭐️⭐️）
* [ ] 辅助线功能（⭐️⭐️⭐️）
* [ ] 同时操作100个元素FPS 50+（⭐️⭐️）
* [ ] 协同编辑（⭐️⭐️⭐️⭐️⭐️）
* [ ] 离线编辑（⭐️⭐️⭐️⭐️⭐️）



## 5. 功能使用说明

### 画布操作
- **缩放画布**: `Ctrl`/`Cmd` + 滚轮（以鼠标位置为中心缩放）
- **拖拽画布**: 按住 `空格键` + 左键拖拽，或中键拖拽
- **滚动画布**: 
  - 滚轮：垂直滚动
  - `Shift` + 滚轮：水平滚动

### 元素选择
- **单选元素**: 左键点击元素，或在图层面板中点击图层项
- **多选元素**: `Ctrl`/`Cmd` + 左键点击元素，或在图层面板中 `Ctrl`/`Cmd` + 点击图层项
- **框选元素**: 左键拖动框选多个元素
- **多选框选**: `Ctrl`/`Cmd` + 左键拖动框选（添加到现有选中）
- **取消选中**: 点击画布空白处
- **图层面板**: 左侧显示所有元素列表，包含缩略图和名称，点击可快速选择

### 工具栏操作
- **Move工具**: 默认工具，用于选择和移动元素
- **图形工具**: 选择矩形、圆角矩形、圆形、三角形工具后，在画布上拖拽绘制
- **图片工具**: 点击后选择图片文件，然后在画布上拖拽绘制
- **文本工具**: 选择后在画布上拖拽绘制文本框
- **自动切换**: 绘制完成后自动切换回Move工具

### 元素创建
- **拖拽绘制**: 选择工具后，在画布上按住鼠标左键拖拽来绘制和调整大小
- **实时预览**: 绘制过程中显示元素预览、选中框轮廓和尺寸标签
- **文本自适应**: 文本框的字体大小根据文本框尺寸自动调整（12-48px范围）

### 元素类型
- **图形元素**: 矩形、圆角矩形、圆形、三角形
  - 所有图形元素支持背景色、边框宽度、边框颜色
  - 三角形使用 clip-path 和伪元素实现轮廓渲染，从重心点缩放保持相似性
  - 圆角矩形支持自定义圆角半径
- **图片元素**: 支持 PNG、JPEG 格式，支持灰度、模糊、对比度滤镜
- **文本元素**: 支持字体、字号、颜色、背景色，支持加粗、斜体、下划线、删除线样式，字体大小自适应

### 元素调整大小
- **角点拖动**: 拖动选中框的四个角点，同时调整宽度和高度
- **边缘拖动**: 拖动选中框的四条边，只调整一个维度（宽度或高度）
- **尺寸标签**: 显示在元素下方中心，实时显示当前尺寸
- **宽高比保持**: 圆形元素自动保持宽高相等，图片元素保持原始宽高比

### 元素移动
- **拖拽移动**: 选中元素后，按住鼠标左键拖动即可移动元素
- **多选移动**: 选中多个元素后，拖动任意一个元素可同时移动所有选中元素
- **移动阈值**: 移动超过3px才会触发拖拽，避免误操作

### 浮动工具栏
- **文本工具栏**: 选中文本元素时，在元素上方显示浮动工具栏
  - 支持设置字体、字号、颜色、背景色
  - 支持设置加粗、斜体、下划线、删除线
  - 支持设置对齐方式和行高
- **图形工具栏**: 选中图形元素时，在元素上方显示浮动工具栏
  - 支持设置背景色、边框宽度、边框颜色
  - 圆角矩形支持设置圆角半径
- **图片工具栏**: 选中图片元素时，在元素上方显示浮动工具栏
  - 支持设置滤镜类型（灰度、模糊、对比度）
  - 支持调整滤镜强度
- **工具栏特性**: 
  - 工具栏自动跟随元素位置和视口缩放
  - 工具栏显示在元素上方居中位置
  - 工具栏交互不会影响画布操作

### 图层面板
- **位置**: 左侧固定 240px 宽度的面板
- **功能**: 
  - 显示所有画布元素的列表（最新元素在顶部）
  - 每个图层项包含缩略图、元素名称和类型
  - 点击图层项选择对应元素
  - 支持 `Ctrl`/`Cmd` + 点击进行多选
  - 选中状态与画布同步高亮
- **交互**: 
  - 滚动条仅在鼠标悬停时显示
  - 图层项悬停时显示背景色变化

### 快捷键
- **复制**: `Ctrl`/`Cmd` + `C` - 复制选中的元素
- **粘贴**: `Ctrl`/`Cmd` + `V` - 粘贴元素到鼠标位置
- **删除**: `Delete`/`Backspace` - 删除选中的元素
- **空格键**: 按住空格键 + 左键拖拽可移动画布视口

## 6. 关键脚本说明

* `npm run dev`: 启动本地开发服务器
* `npm run build`: 构建生产环境代码
* `npm run lint`: 运行代码规范检查