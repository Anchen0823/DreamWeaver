# 右键菜单功能指南

## 功能概述

右键菜单为选中的元素提供快捷操作，包括复制、粘贴、删除、编组和解组功能。

## 实现的功能

### 1. 基础操作

#### 复制 (Copy)
- **触发条件**: 选中任意数量的元素
- **快捷键**: `Ctrl+C` / `Cmd+C`
- **功能**: 将选中的元素复制到剪贴板

#### 粘贴 (Paste)
- **触发条件**: 剪贴板中有内容
- **快捷键**: `Ctrl+V` / `Cmd+V`
- **功能**: 在右键点击位置粘贴剪贴板中的元素
- **禁用状态**: 剪贴板为空时显示为禁用

#### 删除 (Delete)
- **触发条件**: 选中任意数量的元素
- **快捷键**: `Delete` / `Backspace`
- **功能**: 删除选中的元素

### 2. 高级操作

#### 编组 (Group)
- **触发条件**: 选中至少 2 个元素
- **功能**: 将选中的多个元素组合成一个组合元素
- **禁用状态**: 选中少于 2 个元素时显示为禁用，并提示"(需选中多个元素)"
- **特点**: 
  - 使用相对坐标系统
  - 支持递归嵌套
  - 自动计算边界框

#### 解组 (Ungroup)
- **触发条件**: 选中至少 1 个组合元素
- **功能**: 解散选中的组合元素，恢复为独立元素
- **禁用状态**: 未选中组合元素时显示为禁用，并提示"(需选中组合元素)"
- **特点**: 
  - 支持递归解组
  - 自动处理坐标转换

## 使用方法

### 基本使用流程

1. **选中元素**
   - 点击单个元素选中
   - 按住 `Ctrl`/`Cmd` 点击多个元素多选
   - 框选多个元素

2. **打开右键菜单**
   - 在选中状态下，右键点击画布任意位置
   - 菜单会显示在鼠标位置

3. **执行操作**
   - 点击菜单项执行相应操作
   - 点击菜单外部或执行操作后，菜单自动关闭

### 组合元素操作示例

#### 创建组合
1. 选中多个元素（至少 2 个）
2. 右键打开菜单
3. 点击"编组"
4. 多个元素被组合成一个组合元素，保持相对位置

#### 解散组合
1. 选中一个或多个组合元素
2. 右键打开菜单
3. 点击"解组"
4. 组合元素被解散，恢复为独立元素

#### 嵌套组合
1. 选中包含组合元素的多个元素
2. 右键打开菜单
3. 点击"编组"
4. 创建嵌套的组合结构

## 菜单状态说明

### 启用状态
- 菜单项可点击
- 文字颜色正常
- 鼠标悬停时有高亮效果

### 禁用状态
- 菜单项不可点击
- 文字颜色变浅（透明度 50%）
- 鼠标悬停时无高亮效果
- 显示禁用原因提示

## 技术特性

### 坐标转换
- 粘贴时，元素位置基于右键点击位置
- 自动将屏幕坐标转换为画布逻辑坐标
- 考虑视口偏移和缩放比例

### 事件处理
- 使用 `@mousedown.stop` 和 `@click.stop` 阻止事件冒泡
- 全局点击事件监听，点击菜单外部自动关闭
- 右键事件 `preventDefault()` 阻止浏览器默认菜单

### 响应式更新
- 实时检测剪贴板状态
- 实时检测选中元素类型
- 动态显示/隐藏禁用状态

## 界面样式

### 视觉设计
- 白色背景，圆角卡片样式
- 柔和的阴影效果
- 清晰的分隔线

### 交互反馈
- 悬停时背景变浅
- 禁用状态透明度降低
- 平滑的过渡动画

### 图标和文字
- Emoji 图标，直观易懂
- 清晰的操作标签
- 快捷键提示（右侧显示）
- 禁用原因提示（右侧显示）

## 快捷键总结

| 操作 | Windows | macOS |
|------|---------|-------|
| 复制 | `Ctrl+C` | `Cmd+C` |
| 粘贴 | `Ctrl+V` | `Cmd+V` |
| 删除 | `Delete` | `Delete` |
| 编组 | 右键菜单 | 右键菜单 |
| 解组 | 右键菜单 | 右键菜单 |

## 注意事项

1. **粘贴位置**: 粘贴的元素会出现在右键点击的位置，而不是原始位置
2. **编组限制**: 必须选中至少 2 个元素才能编组
3. **解组限制**: 只能解组组合元素，普通元素无法解组
4. **菜单关闭**: 执行操作或点击菜单外部会自动关闭菜单
5. **未选中状态**: 如果没有选中任何元素，右键点击不会显示菜单

## 相关文件

- **组件**: `app/src/components/ContextMenu.vue`
- **集成**: `app/src/components/Canvas.vue`
- **剪贴板**: `app/src/composables/useClipboard.ts`
- **组合功能**: `app/src/composables/useElementGrouping.ts`
- **数据结构**: `app/src/types/canvas.ts`

## 未来扩展

可能的增强功能：
- 显示元素类型信息
- 添加更多操作（锁定、隐藏等）
- 支持键盘快捷键操作菜单
- 添加子菜单支持
- 自定义菜单项顺序

